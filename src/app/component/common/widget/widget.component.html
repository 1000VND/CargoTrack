<div class="d-flex flex-column flex-grow-1">
  <div class="d-flex justify-content-between align-items-center header-container">
    <!-- Tiêu đề -->
    <h6 class="text-primary fw-bold m-0">{{ title }}</h6>
  
    <!-- Nút chức năng -->
    <div class="d-flex gap-2">
      <!-- Nút Thu vào/Mở rộng -->
      <button class="btn btn-sm" type="button" (click)="onToggleCollapse()">
        <i class="fa-solid" [ngClass]="isShowCollapse ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
      </button>
  
      <!-- Nút Reload -->
      <button class="btn btn-sm" (click)="onReload()">
        <i class="fa-solid fa-rotate-right"></i>
      </button>
  
      <!-- Dropdown Menu: Tùy chỉnh độ rộng -->
      <div class="dropdown d-none d-sm-block">
        <button class="btn btn-sm" type="button" id="dropdownMenu">
          <i class="fa-solid fa-ellipsis-vertical"></i>
        </button>
      
        <ul class="dropdown-menu dropdown-parent" aria-labelledby="dropdownMenu">
          <!-- Mục "Độ rộng" có submenu -->
          <li class="dropdown-submenu">
            <a class="dropdown-item text-muted fw-semibold d-flex justify-content-between align-items-center">
              Độ rộng <i class="fa-solid fa-angle-right"></i>
            </a>
            <ul class="dropdown-menu dropdown-child">
              <li *ngFor="let option of widthOptions; let i=index;" (click)="onChangeWidth(option.value)">
                <a class="dropdown-item" [class.active]="option.value === selectedItemWidth">
                  {{ option.label }}
                  <span *ngIf="option.value === selectedItemWidth">
                    <i class="fa-solid fa-check text-primary"></i>
                  </span>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="collapse" [ngClass]="{'show d-flex flex-column': !isShowCollapse}">
    <div class="card-body d-flex flex-grow-1 justify-content-center m-3">
  
      <!-- Widget Card  -->
      <div class="row flex-grow-1 m-0 gap-2 justify-content-center" *ngIf="type === 'card'">
        <div class="card-item p-0 flex-grow-1" style="background-color: #006adc;" [ngClass]="widthWidgetCardItem">
          <div class="d-flex flex-column text-start p-2">
            <span class="fw-semibold">Tổng số phương tiện của công ty</span>
            <span class="col fw-semibold my-2">{{ totalDataWidgetCard() }} Phương tiện</span>
          </div>
        </div>
        <div *ngFor="let data of dataWidgetCard" class="card-item p-0 flex-grow-1" [style.background-color]="data.color"
          [ngClass]="widthWidgetCardItem">
          <div class="d-flex flex-column text-start p-2">
            <span class="fw-semibold">{{data.title}}</span>
            <span class="col fw-semibold my-2">{{data.value}} Phương tiện</span>
            <p>{{ ((data.value / totalDataWidgetCard()) * 100).toFixed(0)}}% / Tổng phương tiện</p>
          </div>
        </div>
      </div>
  
      <!-- Widget Doughnut -->
      <div class="row w-100" style="overflow-x: auto; overflow-y: hidden;" *ngIf="type === 'doughnut'">
        <div class="doughnutchart-container d-flex flex-column justify-content-center align-items-center p-0">
          <!-- 
          innerRadius: Độ dày/mỏng của vòng tròn bên trong
          startAngle: Góc bắt đầu của vòng tròn
          resolveLabelOverlapping: Xử lý hiển thị nhãn trùng lắp 
          -->
          <dx-pie-chart
            #pieChart 
            id="chart" 
            class="px-0" 
            type="doughnut" 
            centerTemplate="centerTemplate"
            [palette]="customPalette" 
            [dataSource]="dataWidgetDoughnut" 
            [innerRadius]="0.6" 
            [startAngle]="110" 
            [resolveLabelOverlapping]="'none'">
            <dxi-series argumentField="label" valueField="value">
              <dxo-label [visible]="true" [customizeText]="customizeLabel" [backgroundColor]="'transparent'">
                <dxo-font color="#321523"></dxo-font>
                <dxo-connector color="#321523" [visible]="true"></dxo-connector>
              </dxo-label>
            </dxi-series>
            <dxo-export [enabled]="false"></dxo-export>
            <dxo-legend [visible]="false"></dxo-legend>
            <dxo-tooltip [enabled]="false" [customizeTooltip]="customizeLabel">
            </dxo-tooltip>
  
            <svg *dxTemplate="let pieChart of 'centerTemplate'">
              <circle cx="100" cy="100" [attr.r]="pieChart.getInnerRadius() - 6" fill="#ffffff"></circle>
              <text text-anchor="middle" style="font-size: 18px" x="100" y="100" fill="#494949">
                <tspan x="100" y="95" style="font-weight: 600">
                  {{totalDataCenterChart()}}
                </tspan>
                <tspan x="100" y="120" style="font-size: 12px; font-weight: normal;">phương tiện</tspan>
              </text>
            </svg>
          </dx-pie-chart>
          
          <div class="marker-legend d-flex justify-content-center px-0 gap-3">
            <div class="d-flex align-items-center gap-2" *ngFor="let item of dataWidgetDoughnut">
              <div class="marker-legend-icon" [style.background-color]="item.color">
              </div>
              <span class="marker-legend-label">{{item.label}}</span>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Widget Bar -->
      <div class="row w-100" style="overflow-x: auto; overflow-y: hidden;" *ngIf="type === 'bar'">
        <div class="d-flex justify-content-start align-items-center p-0">
          <div class="col-auto h-100">
            <span class="mx-2" style="font-size: 12px;">Số phương tiện</span>
          </div>
          <div class="chart-wrapper">
            <dx-chart 
              id="chart" 
              [dataSource]="dataWidgetBar!.data" 
              [size]="{ width: (dataWidgetBar!.data.length * gapBar) }">
              <dxi-series 
                argumentField="label"
                valueField="value"
                type="bar"
                barOverlapGroup="1"
                [color]="dataWidgetBar!.color"
                [barWidth]="40">
                <dxo-label [visible]="true" backgroundColor="transparent">
                  <dxo-font color="black"></dxo-font>
                </dxo-label>
              </dxi-series>
          
              <dxi-value-axis [minValueMargin]="0" [maxValueMargin]="1"></dxi-value-axis>
              <dxo-argument-axis>
                <dxo-label [visible]="true">
                  <dxo-font weight="bold" color="black"></dxo-font>
                </dxo-label>
              </dxo-argument-axis>
              <dxo-legend [visible]="false"></dxo-legend>
            </dx-chart>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
